<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TypeSprint M√©dico ‚Äî Arcade</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@500;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0a0b12; --ink:#e6f1ff; --muted:#8ea2c6; --neon1:#00e5ff; --neon2:#6affc1; --danger:#ff5d7a; }
    html,body{ height:100%; }
    body{ font-family:'Inter',system-ui,Segoe UI,Roboto; color:var(--ink); background: radial-gradient(1200px 600px at 20% -10%, #102038 0%, transparent 60%), radial-gradient(1000px 800px at 120% 20%, #0a2a3a 0%, transparent 55%), var(--bg); }
    .game-title{ font-family:'Chakra Petch', monospace; letter-spacing:.5px; }
    .glass{ background: linear-gradient(180deg, rgba(19,28,49,.7), rgba(11,16,33,.7)); border:1px solid rgba(255,255,255,.06); backdrop-filter: blur(8px); }
    .gridlines:before{ content:""; position:absolute; inset:0; background-image:linear-gradient(rgba(255,255,255,.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,.05) 1px, transparent 1px); background-size: 38px 38px; mask-image: radial-gradient(ellipse at center, black 40%, transparent 70%); pointer-events:none; }
    .neon{ text-shadow: 0 0 12px var(--neon1), 0 0 24px var(--neon1), 0 0 36px var(--neon2); }
    .btn{ position:relative; border:1px solid rgba(255,255,255,.1); transition: transform .08s ease, box-shadow .2s ease; }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.35), 0 0 14px rgba(0,229,255,.25); }
    .btn-primary{ background: linear-gradient(90deg, var(--neon1), var(--neon2)); color:#001016; font-weight:800; }
    .badge{ border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.06); }
    .hud{ font-family:'Chakra Petch', monospace; }
    .caret-custom{ caret-color: var(--neon1); }
    .target-char{ position:relative; }
    .target-char::after{ content:""; position:absolute; left:0; right:0; bottom:-4px; height:4px; background:linear-gradient(90deg,var(--neon1),var(--neon2)); border-radius:999px; animation:pulse 1.1s ease-in-out infinite; }
    @keyframes pulse{ 0%{opacity:.35} 50%{opacity:1} 100%{opacity:.35} }
    .shake{ animation: shake .18s linear; }
    @keyframes shake{ 0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)} }
    .progress{ height:10px; border-radius:9999px; background:linear-gradient(90deg,var(--neon1),var(--neon2)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); }
    .scanlines{ position:relative; overflow:hidden; }
    .scanlines::after{ content:""; position:absolute; inset:-200% 0 0 0; background: repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 2px, transparent 2px 4px); animation: scan 8s linear infinite; pointer-events:none; }
    @keyframes scan{ to{ transform: translateY(50%); } }
    .modal-bg{ background: radial-gradient(600px 300px at 30% 0%, rgba(0,229,255,.18), transparent 60%), rgba(5,7,16,.75); backdrop-filter: blur(10px); }
    .modal-card{ background: linear-gradient(180deg, rgba(16,20,40,.9), rgba(10,12,24,.9)); border:1px solid rgba(255,255,255,.08); box-shadow: 0 10px 40px rgba(0,0,0,.5), 0 0 0 1px rgba(0,229,255,.12) inset; }
    .avatar{ background: radial-gradient(circle at 30% 30%, rgba(0,229,255,.35), transparent 40%), radial-gradient(circle at 70% 70%, rgba(106,255,193,.25), transparent 40%), #0e1428; border:1px solid rgba(255,255,255,.08); }
  </style>
</head>
<body class="min-h-screen relative">
  <div class="absolute inset-0 gridlines"></div>
  <div class="max-w-7xl mx-auto p-4 sm:p-6">
    <header class="flex items-center justify-between gap-4 mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl grid place-items-center bg-[rgba(0,229,255,.12)] border border-[rgba(255,255,255,.08)] shadow-[0_0_24px_rgba(0,229,255,.18)]">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-cyan-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>
        </div>
        <div>
          <h1 class="game-title text-4xl font-extrabold"><span class="neon">TypeSprint</span> <span class="text-cyan-300">M√©dico</span></h1>
          <p class="text-sm text-[var(--muted)]">Arcade de frappe ¬∑ Phrases ARM/SMUR ¬∑ Classement en ligne</p>
        </div>
      </div>
      <button id="darkToggle" class="btn px-3 py-2 rounded-lg text-sm badge">üåô / ‚òÄÔ∏è</button>
    </header>

    <div class="grid gap-6 lg:grid-cols-[1fr,360px]">
      <div class="space-y-6">
        <section class="grid xl:grid-cols-2 gap-4">
          <div class="glass rounded-2xl p-5 scanlines">
            <h2 class="game-title text-lg mb-4">Param√®tres de la partie</h2>
            <div class="mt-4 grid grid-cols-2 gap-3">
              <div>
                <label class="text-xs text-[var(--muted)]">Difficult√©</label>
                <select id="difficulty" class="mt-1 w-full rounded-lg px-2 py-2 bg-[#0b0f1e] border border-[rgba(255,255,255,.08)]">
                  <option value="facile">Facile</option>
                  <option value="normal" selected>Normal</option>
                  <option value="difficile">Difficile</option>
                </select>
              </div>
              <div>
                <label class="text-xs text-[var(--muted)]">Dur√©e</label>
                <select id="duration" class="mt-1 w-full rounded-lg px-2 py-2 bg-[#0b0f1e] border border-[rgba(255,255,255,.08)]">
                  <option value="30">30 s</option>
                  <option value="60" selected>60 s</option>
                  <option value="120">120 s</option>
                </select>
              </div>
            </div>
            <div class="mt-5 flex items-center justify-between">
              <label class="flex items-center gap-2 text-sm text-[var(--muted)]"><input id="soundToggle" type="checkbox" class="rounded"> Sons</label>
              <div class="flex items-center gap-2">
                <button id="startBtn" class="btn btn-primary px-5 py-2 rounded-lg">D√âMARRER</button>
                <button id="resetBtn" class="btn px-4 py-2 rounded-lg badge">R√©initialiser</button>
              </div>
            </div>
          </div>
          <div class="glass rounded-2xl p-5 scanlines">
            <h2 class="game-title text-lg mb-3">Session</h2>
            <div class="grid grid-cols-4 gap-3 hud">
              <div class="text-center"><div class="text-[10px] text-[var(--muted)] mb-1">Temps</div><div id="time" class="text-3xl font-extrabold">60</div></div>
              <div class="text-center"><div class="text-[10px] text-[var(--muted)] mb-1">WPM</div><div id="wpm" class="text-3xl font-extrabold">0</div></div>
              <div class="text-center"><div class="text-[10px] text-[var(--muted)] mb-1">Pr√©cision</div><div id="accuracy" class="text-3xl font-extrabold">100%</div></div>
              <div class="text-center"><div class="text-[10px] text-[var(--muted)] mb-1">Erreurs</div><div id="errors" class="text-3xl font-extrabold text-[var(--danger)]">0</div></div>
            </div>
            <div class="mt-4 bg-[#0b0f1e] rounded-xl overflow-hidden border border-[rgba(255,255,255,.06)]"><div class="progress" id="progress" style="width:100%"></div></div>
          </div>
        </section>

        <section class="glass rounded-2xl p-6 scanlines relative" id="arena">
          <div class="min-h-[170px] sm:min-h-[210px] grid"><div id="textZone" class="text-lg sm:text-2xl leading-relaxed select-none"></div></div>
          <div class="mt-4"><input id="typing" type="text" placeholder="Tape ici‚Ä¶" class="w-full caret-custom rounded-xl px-4 py-3 bg-[#0b0f1e] border border-[rgba(255,255,255,.08)] outline-none focus:border-cyan-300 placeholder:text-[var(--muted)]" disabled></div>
          <div class="mt-2 text-xs text-[var(--muted)]">Appuie sur <kbd class="px-1 py-0.5 rounded bg-[#0b0f1e] border border-[rgba(255,255,255,.08)]">Entr√©e</kbd> pour d√©marrer.</div>
          <div id="countdown" class="hidden absolute inset-0 grid place-items-center"><div class="text-7xl font-extrabold text-cyan-300 neon"></div></div>
        </section>
      </div>

      <aside class="lg:sticky lg:top-4 h-fit space-y-4">
        <div class="glass rounded-2xl p-5">
          <div class="flex items-center justify-between"><h2 class="game-title">üèÜ Classement (Top 10)</h2><span id="fbStatus" class="text-[10px] px-2 py-1 rounded badge">Hors ligne</span></div>
          <ol id="leaderboard" class="space-y-2 text-sm mt-3"></ol>
          <button id="clearLocal" class="mt-3 text-xs underline text-[var(--muted)]">Effacer scores locaux (cache)</button>
          <button id="copyScore" class="mt-3 btn px-4 py-2 rounded-lg badge">Copier le score</button>
        </div>
      </aside>
    </div>
  </div>

  <!-- Modal nom joueur -->
  <div id="profileModal" class="fixed inset-0 hidden items-center justify-center p-4 modal-bg">
    <div class="modal-card w-full max-w-lg rounded-2xl p-6">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-14 h-14 rounded-xl avatar grid place-items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-cyan-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="8" r="4"/><path d="M4 20c2-4 6-6 8-6s6 2 8 6"/></svg>
        </div>
        <div>
          <h3 class="game-title text-2xl">Nouvelle partie</h3>
          <p class="text-sm text-[var(--muted)]">Entre ton <strong>nom</strong> pour le classement.</p>
        </div>
      </div>
      <div class="grid sm:grid-cols-[1fr_auto] gap-3">
        <input id="playerName" type="text" placeholder="Ex: Mat√©o" class="rounded-lg px-3 py-3 bg-[#0b0f1e] border border-[rgba(255,255,255,.12)] outline-none focus:border-cyan-300">
        <button id="saveProfile" class="btn btn-primary rounded-lg px-5">JOUER</button>
      </div>
      <p id="nameError" class="mt-2 text-[12px] text-[var(--danger)] hidden">Le nom est obligatoire.</p>
      <div class="flex items-center justify-between mt-4">
        <span id="authInfo" class="text-[10px] text-[var(--muted)]">√âtat : non connect√©</span>
        <button id="closeProfile" class="btn px-3 py-2 rounded-lg badge">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 top-4 z-50 hidden"><div class="px-4 py-2 rounded-xl bg-black/80 border border-[rgba(255,255,255,.12)]">Copi√© dans le presse-papiers ‚úÖ</div></div>

  <!-- Sons -->
  <audio id="sndHit" src="https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3" preload="auto"></audio>
  <audio id="sndErr" src="https://assets.mixkit.co/active_storage/sfx/2564/2564-preview.mp3" preload="auto"></audio>

  <script type="module">
    // ===== Firebase (optionnel) =====
    const firebaseConfig = {
  apiKey: "AIzaSyBDdqP2oe9pIqqwNLwHTotEgje8pkr09Xk",
  authDomain: "jeux-1f6e3.firebaseapp.com",
  databaseURL: "https://jeux-1f6e3-default-rtdb.firebaseio.com",
  projectId: "jeux-1f6e3",
  storageBucket: "https://jeux-1f6e3-default-rtdb.europe-west1.firebasedatabase.app",
  messagingSenderId: "877311925161",
  appId: "1:877311925161:web:dd03142f7b0b19fbca02b8",
  measurementId: "G-LEBLSSDWSD";
    let app, auth, db, fbEnabled=false, currentUser=null;
    try {
      const hasConfig = Object.values(firebaseConfig).every(v => typeof v === 'string' && !v.includes('_') && v.length>0);
      if (hasConfig) {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js');
        const { getAuth, signInAnonymously, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js');
        const { getDatabase, ref, push, query, orderByChild, limitToLast, get } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js');
        app = initializeApp(firebaseConfig); auth = getAuth(app); db = getDatabase(app); fbEnabled=true;
        signInAnonymously(auth).catch(console.error);
        onAuthStateChanged(auth,(u)=>{ currentUser=u; updateAuthInfo(); });
        fbStatus.textContent='Connect√©'; fbStatus.className='text-[10px] px-2 py-1 rounded badge bg-[rgba(0,255,170,.1)] text-emerald-300';
        await loadOnlineLeaderboard();
      }
    } catch(e){ console.warn('Firebase non initialis√©:', e); fbStatus.textContent='Hors ligne'; }

    async function submitScoreOnline(score){ if(!fbEnabled||!db) return; const { ref, push } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js'); const key='typing-scores'; const name=(localStorage.getItem('playerName')||'Anonyme').slice(0,32); const data={ name, ...score }; try{ await push(ref(db,key), data); }catch(e){ console.error(e); } }
    async function loadOnlineLeaderboard(){ if(!fbEnabled||!db) return []; const { ref, query, orderByChild, limitToLast, get } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js'); const key='typing-scores'; const q=query(ref(db,key), orderByChild('wpm'), limitToLast(20)); const snap=await get(q); const arr=[]; if(snap.exists()) snap.forEach(s=>arr.push(s.val())); arr.sort((a,b)=> b.wpm - a.wpm || b.acc - a.acc || a.errors - b.errors); renderOnlineLeaderboard(arr.slice(0,10)); return arr; }
    function renderOnlineLeaderboard(list){ const lb=document.getElementById('leaderboard'); lb.innerHTML=''; if(!list.length){ lb.innerHTML='<li class="text-[var(--muted)]">Aucun score pour le moment.</li>'; return; } list.slice(0,10).forEach((s,i)=>{ const initials=(s.name||'Anonyme').split(/\s+/).map(x=>x[0]?.toUpperCase()).filter(Boolean).slice(0,2).join('')||'A'; const li=document.createElement('li'); li.innerHTML=`<div class="flex items-center gap-3"><div class="w-8 h-8 rounded-lg bg-[#0b0f1e] border border-[rgba(255,255,255,.1)] grid place-items-center text-xs font-bold">${initials}</div><div class="flex-1"><div class="flex items-center justify-between"><span class="font-semibold">${escapeHtml(s.name||'Anonyme')}</span><span class="text-[10px] text-[var(--muted)]">#${i+1}</span></div><div class="text-[var(--muted)] text-[12px]">${s.wpm} WPM ‚Ä¢ ${s.acc}% ‚Ä¢ ${s.mode}/${s.diff}</div></div></div>`; lb.appendChild(li); }); }
    function updateAuthInfo(){ const el=document.getElementById('authInfo'); if(!el) return; const name=localStorage.getItem('playerName')||'Anonyme'; el.textContent = `Nom: ${name} ‚Ä¢ ${currentUser? 'Connect√©' : 'Hors ligne'}`; }

    // ===== Jeu (mode Phrases uniquement) =====
    const PHRASES=[
      "Restez en ligne, l'√©quipe est en route vers vous.",
      "Pouvez-vous me donner l'adresse exacte de l'urgence ?",
      "La victime respire-t-elle normalement ou pr√©sente-t-elle des pauses ?",
      "Depuis quand la douleur thoracique a-t-elle commenc√© ?",
      "Avez-vous observ√© une perte de connaissance, m√™me br√®ve ?",
      "Placez la personne en position lat√©rale de s√©curit√© si elle respire.",
      "Commencez les compressions : trente compressions puis deux insufflations.",
      "Quel num√©ro puis-je composer pour vous rappeler si la ligne coupe ?",
      "L'enfant r√©agit-il quand on lui parle ou on le stimule ?",
      "Administrez l'oxyg√®ne si disponible et surveillez la saturation.",
      "Ant√©c√©dents d'AVC, d'infarctus, d'allergies ou traitement anticoagulant ?",
      "Le SMUR part dans cinq minutes, restez pr√®s de la victime.",
      "La douleur est-elle continue ou par pouss√©es ? Notez-la sur dix.",
      "Trouble de la parole, asym√©trie du sourire, faiblesse d'un c√¥t√© ?",
      "Maintenez t√™te et cou align√©s en cas de traumatisme.",
      "A√©rez si suspicion d'intoxication au monoxyde de carbone.",
      "Ne donnez ni √† boire ni √† manger avant l'examen m√©dical.",
      "Pr√©venez l'acc√®s au b√¢timent et pr√©parez la carte vitale.",
      "Nous estimons l'arriv√©e √† moins de dix minutes selon la circulation.",
      "D√©crivez le saignement : jet, √©coulement constant ou tache ?",
      "La victime prend-elle de l'insuline ou des cortico√Ødes ?",
      "Mesurez si possible la tension et la glyc√©mie, informez-nous du r√©sultat."
    ];

    let running=false, duration=60, remaining=60, interval=null, text='', index=0, typed=0, errors=0, startedAt=null;
    const difficultySel=document.getElementById('difficulty');
    const durationSel=document.getElementById('duration');
    const typing=document.getElementById('typing');
    const textZone=document.getElementById('textZone');
    const timeEl=document.getElementById('time');
    const wpmEl=document.getElementById('wpm');
    const accEl=document.getElementById('accuracy');
    const errEl=document.getElementById('errors');
    const startBtn=document.getElementById('startBtn');
    const resetBtn=document.getElementById('resetBtn');
    const clearLocal=document.getElementById('clearLocal');
    const copyScoreBtn=document.getElementById('copyScore');
    const sndHit=document.getElementById('sndHit');
    const sndErr=document.getElementById('sndErr');
    const progress=document.getElementById('progress');

    const profileModal=document.getElementById('profileModal');
    const closeProfile=document.getElementById('closeProfile');
    const saveProfile=document.getElementById('saveProfile');
    const playerName=document.getElementById('playerName');
    const nameError=document.getElementById('nameError');

    function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function generateText(){ const count = difficultySel.value==='facile'? 3 : difficultySel.value==='difficile'? 6 : 4; text = Array.from({length:count},()=>rand(PHRASES)).join(' '); }
    function escapeHtml(s=''){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    function renderText(){ const done=text.slice(0,index); const current=text[index]||''; const rest=text.slice(index+1); textZone.innerHTML=`<span class="text-[var(--muted)]">${escapeHtml(done)}</span><span class="target-char font-semibold">${escapeHtml(current||' ')}</span><span>${escapeHtml(rest)}</span>`; }
    function reset(all=true){ running=false; index=0; typed=0; errors=0; remaining=duration=parseInt(durationSel.value,10)||60; startedAt=null; clearInterval(interval); interval=null; timeEl.textContent=String(duration); wpmEl.textContent='0'; accEl.textContent='100%'; errEl.textContent='0'; progress.style.width='100%'; typing.value=''; typing.disabled=false; typing.blur(); if(all) generateText(); renderText(); }

    // flux de d√©part
    function start(){ openNameModal().then(ok=>{ if(!ok) return; countdownThenGo(); }); }
    function openNameModal(){ return new Promise((resolve)=>{ profileModal.classList.remove('hidden'); profileModal.classList.add('flex'); updateAuthInfo(); playerName.value = localStorage.getItem('playerName')||''; playerName.focus(); const cancel=()=>{ profileModal.classList.add('hidden'); profileModal.classList.remove('flex'); resolve(false); }; closeProfile.onclick=cancel; saveProfile.onclick=()=>{ const n=playerName.value.trim(); if(!n){ nameError.classList.remove('hidden'); playerName.focus(); return; } nameError.classList.add('hidden'); localStorage.setItem('playerName', n); updateAuthInfo(); profileModal.classList.add('hidden'); profileModal.classList.remove('flex'); resolve(true); }; playerName.onkeydown=(e)=>{ if(e.key==='Enter'){ saveProfile.click(); } }; }); }
    function countdownThenGo(){ const overlay=document.getElementById('countdown'); const label=overlay.firstElementChild; overlay.classList.remove('hidden'); const seq=['3','2','1','GO!']; let i=0; const tick=()=>{ label.textContent=seq[i]; i++; if(i<seq.length) setTimeout(tick,700); else setTimeout(()=>{ overlay.classList.add('hidden'); startGame(); }, 600); }; tick(); }
    function startGame(){ if(running) return; running=true; startedAt=performance.now(); typing.focus(); interval=setInterval(()=>{ remaining--; timeEl.textContent=String(remaining); const pct=Math.max(0, Math.round(remaining/duration*100)); progress.style.width=pct+'%'; if(remaining<=0) finish(); },1000); }

    function finish(){ running=false; clearInterval(interval); interval=null; typing.disabled=true; const minutes=(duration-remaining)/60 || 1/60; const wpm=Math.max(0, Math.round((typed/5)/minutes)); const acc=typed+errors===0? 100: Math.round(typed/(typed+errors)*100); wpmEl.textContent=String(wpm); accEl.textContent=acc+'%'; const score={ mode:'phrases', diff:difficultySel.value, wpm, acc, errors, date:new Date().toISOString() }; submitScoreOnline(score).then(()=> loadOnlineLeaderboard()); textZone.classList.add('shake'); setTimeout(()=> textZone.classList.remove('shake'), 220); localStorage.setItem('lastScore', JSON.stringify(score)); }
    function updateStats(){ const elapsed=Math.max(1,(performance.now()-(startedAt||performance.now()))/1000); const minutes=elapsed/60; const wpm=Math.round((typed/5)/minutes); const acc=typed+errors===0? 100: Math.round(typed/(typed+errors)*100); wpmEl.textContent=String(isFinite(wpm)? wpm:0); accEl.textContent=(isFinite(acc)? acc:100)+'%'; errEl.textContent=String(errors); }

    function handleInput(){ if(!running) return; const v=typing.value; const last=v[v.length-1]; if(last==null) return; const expected=text[index]; if(last===expected){ typed++; index++; if(document.getElementById('soundToggle').checked){ sndHit.currentTime=0; sndHit.play(); } renderText(); updateStats(); typing.value=''; if(index>=text.length){ generateText(); index=0; renderText(); } } else { errors++; if(document.getElementById('soundToggle').checked){ sndErr.currentTime=0; sndErr.play(); } textZone.classList.add('shake'); setTimeout(()=> textZone.classList.remove('shake'), 120); updateStats(); typing.value=''; } }

    function showToast(){ const t=document.getElementById('toast'); t.classList.remove('hidden'); setTimeout(()=> t.classList.add('hidden'),1500); }

    // √©v√©nements UI
    difficultySel.addEventListener('change', ()=>{ reset(); typing.focus(); });
    durationSel.addEventListener('change', ()=>{ reset(false); });
    startBtn.addEventListener('click', start);
    resetBtn.addEventListener('click', ()=> reset());
    typing.addEventListener('input', handleInput);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Enter' && !running) start(); });

    copyScoreBtn.addEventListener('click',()=>{ const raw=localStorage.getItem('lastScore'); if(!raw){ showToast(); return; } const s=JSON.parse(raw); const t=`Score ‚Äî ${localStorage.getItem('playerName')||'Anonyme'} ‚Ä¢ ${s.wpm} WPM ‚Ä¢ ${s.acc}% ‚Ä¢ erreurs ${s.errors} (${s.mode}/${s.diff})`; navigator.clipboard.writeText(t).then(showToast); });
    clearLocal.addEventListener('click',()=>{ localStorage.removeItem('lastScore'); showToast(); });

    // Th√®me
    const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches; const savedTheme=localStorage.getItem('theme')||(prefersDark?'dark':'light'); if(savedTheme==='dark') document.documentElement.classList.add('dark'); document.getElementById('darkToggle').addEventListener('click',()=>{ document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', document.documentElement.classList.contains('dark')? 'dark':'light'); });

    // Init
    (function init(){ generateText(); renderText(); })();
  </script>
</body>
</html>